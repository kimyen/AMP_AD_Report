-- TODO: update ampad.ENTITY_ID
INSERT IGNORE INTO ampad.ENTITY_ID
SELECT DISTINCT ID 
FROM NODE_SNAPSHOT
WHERE PROJECT_ID = 2580853;

-- Access Record about entities in AMP_AD project in this month
-- TODO: change the name of the table
CREATE TABLE ampad.NOV (
SESSION_ID CHAR(36),
TIMESTAMP BIGINT(20),
ELAPSE_MS BIGINT(20),
RETURN_OBJECT_ID VARCHAR(22),
USER_ID BIGINT(20),
DATE DATE,
METHOD enum('GET','PUT','POST','DELETE'),
RESPONSE_STATUS INT(11),
ENTITY_ID BIGINT(20),
CLIENT enum('R','PYTHON','WEB','JAVA','COMMAND_LINE','ELB_HEALTHCHECKER','UNKNOWN'),
NORMALIZED_METHOD_SIGNATURE VARCHAR(100)
);

-- TODO:
-- 1. change the name of the table
-- 2. change the timestamp range
INSERT IGNORE INTO ampad.NOV
SELECT AR.SESSION_ID, AR.TIMESTAMP, AR.ELAPSE_MS, AR.RETURN_OBJECT_ID, AR.USER_ID, AR.DATE, AR.METHOD, AR.RESPONSE_STATUS,
	PAR.ENTITY_ID, PAR.CLIENT, PAR.NORMALIZED_METHOD_SIGNATURE
FROM warehouse.ACCESS_RECORD AR, warehouse.PROCESSED_ACCESS_RECORD PAR
WHERE AR.SESSION_ID = PAR.SESSION_ID
	AND AR.TIMESTAMP = PAR.TIMESTAMP
	AND AR.TIMESTAMP BETWEEN 1446336000000 AND (1448928000000 - 1)
	AND PAR.ENTITY_ID IN (SELECT * FROM ampad.ENTITY_ID);

-- Access Record represents web views
-- TODO: change table name
CREATE TABLE ampad.WEB_ACCESS_NOV (
SESSION_ID CHAR(36),
TIMESTAMP BIGINT(20),
ELAPSE_MS BIGINT(20),
RETURN_OBJECT_ID VARCHAR(22),
USER_ID BIGINT(20),
DATE DATE,
METHOD enum('GET','PUT','POST','DELETE'),
RESPONSE_STATUS INT(11),
ENTITY_ID BIGINT(20),
CLIENT enum('R','PYTHON','WEB','JAVA','COMMAND_LINE','ELB_HEALTHCHECKER','UNKNOWN'),
NORMALIZED_METHOD_SIGNATURE VARCHAR(100)
);

-- TODO: 
-- 1. change table name on INSERT INTO
-- 2. change table name on FROM
INSERT IGNORE INTO ampad.WEB_ACCESS_NOV
SELECT * FROM ampad.NOV
WHERE CLIENT = 'WEB'
	AND (NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/bundle'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/bundle'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki2'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki2/#');

-- Access Record represents R access
-- TODO: change table name
CREATE TABLE ampad.R_ACCESS_NOV (
SESSION_ID CHAR(36),
TIMESTAMP BIGINT(20),
ELAPSE_MS BIGINT(20),
RETURN_OBJECT_ID VARCHAR(22),
USER_ID BIGINT(20),
DATE DATE,
METHOD enum('GET','PUT','POST','DELETE'),
RESPONSE_STATUS INT(11),
ENTITY_ID BIGINT(20),
CLIENT enum('R','PYTHON','WEB','JAVA','COMMAND_LINE','ELB_HEALTHCHECKER','UNKNOWN'),
NORMALIZED_METHOD_SIGNATURE VARCHAR(100)
);

-- TODO: 
-- 1. change table name on INSERT INTO
-- 2. change table name on FROM
INSERT IGNORE INTO ampad.R_ACCESS_NOV
SELECT * FROM ampad.NOV
WHERE CLIENT = 'R'
	AND (NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/doi'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/doi'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/bundle'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/bundle'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/annotations'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/annotations'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/filepreview'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/filepreview'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/filehandles'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/filehandles'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wikikey'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki/#'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki2'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki2/#');

-- Access Record represents Python access
-- TODO: change table name
CREATE TABLE ampad.PY_ACCESS_NOV (
SESSION_ID CHAR(36),
TIMESTAMP BIGINT(20),
ELAPSE_MS BIGINT(20),
RETURN_OBJECT_ID VARCHAR(22),
USER_ID BIGINT(20),
DATE DATE,
METHOD enum('GET','PUT','POST','DELETE'),
RESPONSE_STATUS INT(11),
ENTITY_ID BIGINT(20),
CLIENT enum('R','PYTHON','WEB','JAVA','COMMAND_LINE','ELB_HEALTHCHECKER','UNKNOWN'),
NORMALIZED_METHOD_SIGNATURE VARCHAR(100)
);

-- TODO: 
-- 1. change table name on INSERT INTO
-- 2. change table name on FROM
INSERT IGNORE INTO ampad.PY_ACCESS_NOV
SELECT * FROM ampad.NOV
WHERE CLIENT = 'PYTHON'
	AND (NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/doi'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/doi'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/bundle'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/bundle'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/annotations'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/annotations'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/filepreview'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/filepreview'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/filehandles'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/filehandles'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wikikey'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki/#'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki2'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki2/#');

-- Access Record represents JAVA access
-- TODO: change table name
CREATE TABLE ampad.JAVA_ACCESS_NOV (
SESSION_ID CHAR(36),
TIMESTAMP BIGINT(20),
ELAPSE_MS BIGINT(20),
RETURN_OBJECT_ID VARCHAR(22),
USER_ID BIGINT(20),
DATE DATE,
METHOD enum('GET','PUT','POST','DELETE'),
RESPONSE_STATUS INT(11),
ENTITY_ID BIGINT(20),
CLIENT enum('R','PYTHON','WEB','JAVA','COMMAND_LINE','ELB_HEALTHCHECKER','UNKNOWN'),
NORMALIZED_METHOD_SIGNATURE VARCHAR(100)
);

-- TODO: 
-- 1. change table name on INSERT INTO
-- 2. change table name on FROM
INSERT IGNORE INTO ampad.JAVA_ACCESS_NOV 
SELECT * FROM ampad.NOV
WHERE CLIENT = 'JAVA'
	AND (NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/doi'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/doi'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/bundle'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/bundle'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/annotations'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/annotations'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/filepreview'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/filepreview'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/filehandles'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/filehandles'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wikikey'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki/#'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki2'
		OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki2/#');

-- Access Record represents file download
-- TODO: change table name
CREATE TABLE ampad.DOWNLOAD_NOV (
SESSION_ID CHAR(36),
TIMESTAMP BIGINT(20),
ELAPSE_MS BIGINT(20),
RETURN_OBJECT_ID VARCHAR(22),
USER_ID BIGINT(20),
DATE DATE,
METHOD enum('GET','PUT','POST','DELETE'),
RESPONSE_STATUS INT(11),
ENTITY_ID BIGINT(20),
CLIENT enum('R','PYTHON','WEB','JAVA','COMMAND_LINE','ELB_HEALTHCHECKER','UNKNOWN'),
NORMALIZED_METHOD_SIGNATURE VARCHAR(100)
);

-- TODO: 
-- 1. change table name on INSERT INTO
-- 2. change table name on FROM
INSERT IGNORE INTO ampad.DOWNLOAD_NOV
SELECT * FROM ampad.NOV
WHERE NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/file' 
	OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/version/#/file';

-- TODO
-- 1. change value of month in SELECT CLAUSE
-- 2. change table name in FROM CLAUSE
INSERT IGNORE INTO ampad.DOWNLOAD (USER_ID, SUCCESS, CLIENT, MONTH, ENTITY_ID)
SELECT USER_ID, IF(RESPONSE_STATUS < 400, TRUE, FALSE) AS SUCCESS, CLIENT, 'NOV' AS MONTH, ENTITY_ID
FROM ampad.DOWNLOAD_NOV;

update ampad.DOWNLOAD
set SAGE = IF (USER_ID IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959), TRUE, FALSE);

-- TODO
-- 1. change value of month in SELECT CLAUSE
-- 2. change table name in FROM CLAUSE
INSERT IGNORE INTO ampad.VIEW (USER_ID, CLIENT, MONTH, ENTITY_ID)
SELECT USER_ID, CLIENT, 'NOV' AS MONTH, ENTITY_ID
FROM ampad.WEB_ACCESS_NOV;

-- TODO
-- 1. change value of month in SELECT CLAUSE
-- 2. change table name in FROM CLAUSE
INSERT IGNORE INTO ampad.VIEW (USER_ID, CLIENT, MONTH, ENTITY_ID)
SELECT USER_ID, CLIENT, 'NOV' AS MONTH, ENTITY_ID
FROM ampad.PY_ACCESS_NOV;

-- TODO
-- 1. change value of month in SELECT CLAUSE
-- 2. change table name in FROM CLAUSE
INSERT IGNORE INTO ampad.VIEW (USER_ID, CLIENT, MONTH, ENTITY_ID)
SELECT USER_ID, CLIENT, 'NOV' AS MONTH, ENTITY_ID
FROM ampad.R_ACCESS_NOV;

-- TODO
-- 1. change value of month in SELECT CLAUSE
-- 2. change table name in FROM CLAUSE
INSERT IGNORE INTO ampad.VIEW (USER_ID, CLIENT, MONTH, ENTITY_ID)
SELECT USER_ID, CLIENT, 'NOV' AS MONTH, ENTITY_ID
FROM ampad.JAVA_ACCESS_NOV;
 
update ampad.VIEW
set SAGE = IF (USER_ID IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959), TRUE, FALSE);

-- TODO: 
-- 1. change table name
-- 2. change field name
-- 3. change month value
CREATE TABLE ampad.NOV_NONSAGE_VIEW AS
SELECT ENTITY_ID, COUNT(*) AS NOV
FROM ampad.VIEW
WHERE SAGE = FALSE
AND MONTH = 'NOV'
GROUP BY ENTITY_ID;

-- TODO: 
-- 1. change table name
-- 2. change field name
-- 3. change month value
CREATE TABLE ampad.NOV_SAGE_VIEW AS
SELECT ENTITY_ID, COUNT(*) AS NOV
FROM ampad.VIEW
WHERE SAGE = TRUE
AND MONTH = 'NOV'
GROUP BY ENTITY_ID;

-- TODO: 
-- 1. change table name
-- 2. change field name
-- 3. change month value
CREATE TABLE ampad.NOV_USER_VIEW AS
SELECT USER_ID, COUNT(*) AS NOV
FROM ampad.VIEW
WHERE MONTH = 'NOV'
GROUP BY USER_ID;

-- TODO: 
-- 1. change table name
-- 2. change month value
CREATE TABLE ampad.NOV_NONSAGE_DOWNLOAD AS
SELECT ENTITY_ID, COUNT(*) AS ATTEMPT, SUM(IF(SUCCESS, 1, 0)) AS SUCCESS
FROM ampad.DOWNLOAD
WHERE SAGE = FALSE
AND MONTH = 'NOV'
GROUP BY ENTITY_ID;

-- TODO: 
-- 1. change table name
-- 2. change month value
CREATE TABLE ampad.NOV_SAGE_DOWNLOAD AS
SELECT ENTITY_ID, COUNT(*) AS ATTEMPT, SUM(IF(SUCCESS, 1, 0)) AS SUCCESS
FROM ampad.DOWNLOAD
WHERE SAGE = TRUE
AND MONTH = 'NOV'
GROUP BY ENTITY_ID;

-- TODO: 
-- 1. change table name
-- 2. change month value
CREATE TABLE ampad.NOV_USER_DOWNLOAD AS
SELECT USER_ID, COUNT(*) AS ATTEMPT, SUM(IF(SUCCESS, 1, 0)) AS SUCCESS
FROM ampad.DOWNLOAD
WHERE MONTH = 'NOV'
GROUP BY USER_ID;

-- TODO: 
-- 1. change table name
-- 2. change month value
CREATE TABLE ampad.NOV_CLIENT_NONSAGE_DOWNLOAD AS
SELECT CLIENT, COUNT(*) AS ATTEMPT, SUM(IF(SUCCESS, 1, 0)) AS SUCCESS
FROM ampad.DOWNLOAD
WHERE MONTH = 'NOV'
AND SAGE = FALSE
GROUP BY CLIENT;

DROP TABLE ampad.CLIENT_NONSAGE_VIEW;

-- TODO: add a new month
CREATE TABLE ampad.CLIENT_NONSAGE_VIEW (
CLIENT enum('R','PYTHON','WEB','JAVA','COMMAND_LINE','ELB_HEALTHCHECKER','UNKNOWN'),
MAR BIGINT(20),
APR BIGINT(20),
MAY BIGINT(20),
JUN BIGINT(20),
JUL BIGINT(20),
AUG BIGINT(20),
SEP BIGINT(20),
OCT BIGINT(20),
NOV BIGINT(20),
TOTAL BIGINT(20)
);

-- TODO: 
-- 1. add new month in field list
-- 2. add new SELECT CLAUSE
INSERT IGNORE INTO ampad.CLIENT_NONSAGE_VIEW (CLIENT, MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV)
SELECT 'WEB', 
(SELECT COUNT(*) FROM ampad.WEB_ACCESS_MAR WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.WEB_ACCESS_APR WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.WEB_ACCESS_MAY WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)), 
(SELECT COUNT(*) FROM ampad.WEB_ACCESS_JUN WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.WEB_ACCESS_JUL WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.WEB_ACCESS_AUG WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.WEB_ACCESS_SEP WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.WEB_ACCESS_OCT WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.WEB_ACCESS_NOV WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959));

-- TODO: 
-- 1. add new month in field list
-- 2. add new SELECT CLAUSE
INSERT IGNORE INTO ampad.CLIENT_NONSAGE_VIEW (CLIENT, MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV)
SELECT 'JAVA', 
(SELECT COUNT(*) FROM ampad.JAVA_ACCESS_MAR WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.JAVA_ACCESS_APR WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.JAVA_ACCESS_MAY WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)), 
(SELECT COUNT(*) FROM ampad.JAVA_ACCESS_JUN WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.JAVA_ACCESS_JUL WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.JAVA_ACCESS_AUG WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.JAVA_ACCESS_SEP WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.JAVA_ACCESS_OCT WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.JAVA_ACCESS_NOV WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959));

-- TODO: 
-- 1. add new month in field list
-- 2. add new SELECT CLAUSE
INSERT IGNORE INTO ampad.CLIENT_NONSAGE_VIEW (CLIENT, MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV)
SELECT 'R', 
(SELECT COUNT(*) FROM ampad.R_ACCESS_MAR WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.R_ACCESS_APR WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.R_ACCESS_MAY WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)), 
(SELECT COUNT(*) FROM ampad.R_ACCESS_JUN WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.R_ACCESS_JUL WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.R_ACCESS_AUG WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.R_ACCESS_SEP WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.R_ACCESS_OCT WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.R_ACCESS_NOV WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959));

-- TODO: 
-- 1. add new month in field list
-- 2. add new SELECT CLAUSE
INSERT IGNORE INTO ampad.CLIENT_NONSAGE_VIEW (CLIENT, MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV)
SELECT 'PYTHON', 
(SELECT COUNT(*) FROM ampad.PY_ACCESS_MAR WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.PY_ACCESS_APR WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.PY_ACCESS_MAY WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)), 
(SELECT COUNT(*) FROM ampad.PY_ACCESS_JUN WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.PY_ACCESS_JUL WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.PY_ACCESS_AUG WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.PY_ACCESS_SEP WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.PY_ACCESS_OCT WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959)),
(SELECT COUNT(*) FROM ampad.PY_ACCESS_NOV WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959));


-- TODO: add new month to total
UPDATE ampad.CLIENT_NONSAGE_VIEW
SET TOTAL = MAR + APR + MAY + JUN + JUL + AUG + SEP + OCT + NOV;

DROP TABLE ampad.CLIENT_NONSAGE_DOWNLOAD;

-- TODO: add a new month
CREATE TABLE ampad.CLIENT_NONSAGE_DOWNLOAD (
CLIENT enum('R','PYTHON','WEB','JAVA','COMMAND_LINE','ELB_HEALTHCHECKER','UNKNOWN'),
MAR_ATTEMPT BIGINT(20), MAR_SUCCESS BIGINT(20),
APR_ATTEMPT BIGINT(20), APR_SUCCESS BIGINT(20),
MAY_ATTEMPT BIGINT(20), MAY_SUCCESS BIGINT(20),
JUN_ATTEMPT BIGINT(20), JUN_SUCCESS BIGINT(20),
JUL_ATTEMPT BIGINT(20), JUL_SUCCESS BIGINT(20),
AUG_ATTEMPT BIGINT(20), AUG_SUCCESS BIGINT(20),
SEP_ATTEMPT BIGINT(20), SEP_SUCCESS BIGINT(20),
OCT_ATTEMPT BIGINT(20), OCT_SUCCESS BIGINT(20),
NOV_ATTEMPT BIGINT(20), NOV_SUCCESS BIGINT(20),
TOTAL_ATTEMPT BIGINT(20), TOTAL_SUCCESS BIGINT(20)
);

-- TODO: 
-- 1. add new month in field list
-- 2. add 2 new SELECT CLAUSES
INSERT INTO ampad.CLIENT_NONSAGE_DOWNLOAD (CLIENT, MAR_ATTEMPT, MAR_SUCCESS, APR_ATTEMPT, APR_SUCCESS, 
MAY_ATTEMPT, MAY_SUCCESS, JUN_ATTEMPT, JUN_SUCCESS, JUL_ATTEMPT, JUL_SUCCESS, AUG_ATTEMPT, AUG_SUCCESS,
SEP_ATTEMPT, SEP_SUCCESS, OCT_ATTEMPT, OCT_SUCCESS, NOV_ATTEMPT, NOV_SUCCESS)
SELECT 'PYTHON', 
(SELECT COUNT(*) FROM ampad.DOWNLOAD_MAR 
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_MAR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_APR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_APR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_MAY
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'), 
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_MAY
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'), 
(SELECT COUNT(*) FROM ampad.DOWNLOAD_JUN
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_JUN
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_JUL
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_JUL
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_AUG
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_AUG
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_SEP
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_SEP
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_OCT
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_OCT
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_NOV
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_NOV
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'PYTHON');

-- TODO: 
-- 1. add new month in field list
-- 2. add 2 new SELECT CLAUSES
INSERT INTO ampad.CLIENT_NONSAGE_DOWNLOAD (CLIENT, MAR_ATTEMPT, MAR_SUCCESS, APR_ATTEMPT, APR_SUCCESS, 
MAY_ATTEMPT, MAY_SUCCESS, JUN_ATTEMPT, JUN_SUCCESS, JUL_ATTEMPT, JUL_SUCCESS, AUG_ATTEMPT, AUG_SUCCESS,
SEP_ATTEMPT, SEP_SUCCESS, OCT_ATTEMPT, OCT_SUCCESS, NOV_ATTEMPT, NOV_SUCCESS)
SELECT 'WEB', 
(SELECT COUNT(*) FROM ampad.DOWNLOAD_MAR 
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_MAR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_APR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_APR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_MAY
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'), 
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_MAY
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'), 
(SELECT COUNT(*) FROM ampad.DOWNLOAD_JUN
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_JUN
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_JUL
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_JUL
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_AUG
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_AUG
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_SEP
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_SEP
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_OCT
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_OCT
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_NOV
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_NOV
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'WEB');

-- TODO: 
-- 1. add new month in field list
-- 2. add 2 new SELECT CLAUSES
INSERT INTO ampad.CLIENT_NONSAGE_DOWNLOAD (CLIENT, MAR_ATTEMPT, MAR_SUCCESS, APR_ATTEMPT, APR_SUCCESS, 
MAY_ATTEMPT, MAY_SUCCESS, JUN_ATTEMPT, JUN_SUCCESS, JUL_ATTEMPT, JUL_SUCCESS, AUG_ATTEMPT, AUG_SUCCESS,
SEP_ATTEMPT, SEP_SUCCESS, OCT_ATTEMPT, OCT_SUCCESS, NOV_ATTEMPT, NOV_SUCCESS)
SELECT 'JAVA', 
(SELECT COUNT(*) FROM ampad.DOWNLOAD_MAR 
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_MAR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_APR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_APR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_MAY
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'), 
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_MAY
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'), 
(SELECT COUNT(*) FROM ampad.DOWNLOAD_JUN
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_JUN
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_JUL
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_JUL
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_AUG
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_AUG
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_SEP
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_SEP
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_OCT
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_OCT
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_NOV
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_NOV
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'JAVA');

-- TODO: 
-- 1. add new month in field list
-- 2. add 2 new SELECT CLAUSES
INSERT INTO ampad.CLIENT_NONSAGE_DOWNLOAD (CLIENT, MAR_ATTEMPT, MAR_SUCCESS, APR_ATTEMPT, APR_SUCCESS, 
MAY_ATTEMPT, MAY_SUCCESS, JUN_ATTEMPT, JUN_SUCCESS, JUL_ATTEMPT, JUL_SUCCESS, AUG_ATTEMPT, AUG_SUCCESS,
SEP_ATTEMPT, SEP_SUCCESS, OCT_ATTEMPT, OCT_SUCCESS, NOV_ATTEMPT, NOV_SUCCESS)
SELECT 'R', 
(SELECT COUNT(*) FROM ampad.DOWNLOAD_MAR 
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_MAR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_APR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_APR
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_MAY
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'), 
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_MAY
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'), 
(SELECT COUNT(*) FROM ampad.DOWNLOAD_JUN
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_JUN
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_JUL
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_JUL
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_AUG
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_AUG
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_SEP
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_SEP
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_OCT
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_OCT
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT COUNT(*) FROM ampad.DOWNLOAD_NOV
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R'),
(SELECT SUM(IF(RESPONSE_STATUS < 400, 1, 0)) FROM ampad.DOWNLOAD_NOV
WHERE USER_ID NOT IN (273980, 274008, 372127, 3323072, 273995, 1968150, 273959) AND CLIENT = 'R');

-- TODO: add new month to the eq
UPDATE ampad.CLIENT_NONSAGE_DOWNLOAD
SET TOTAL_SUCCESS = IFNULL(MAR_SUCCESS,0)+IFNULL(APR_SUCCESS,0)+IFNULL(MAY_SUCCESS,0)+IFNULL(JUN_SUCCESS,0)
+IFNULL(JUL_SUCCESS,0)+IFNULL(AUG_SUCCESS,0)+IFNULL(SEP_SUCCESS,0)+IFNULL(OCT_SUCCESS,0)+IFNULL(NOV_SUCCESS,0);

-- TODO: add new month to the eq
UPDATE ampad.CLIENT_NONSAGE_DOWNLOAD
SET TOTAL_ATTEMPT = IFNULL(MAR_ATTEMPT,0)+IFNULL(APR_ATTEMPT,0)+IFNULL(MAY_ATTEMPT,0)+IFNULL(JUN_ATTEMPT,0)
+IFNULL(JUL_ATTEMPT,0)+IFNULL(AUG_ATTEMPT,0)+IFNULL(SEP_ATTEMPT,0)+IFNULL(OCT_ATTEMPT,0)+IFNULL(NOV_ATTEMPT,0);

-- TODO: 
-- 1. change table name
-- 2. change field name in SELECT CLAUSE
-- 3. change FROM
CREATE TABLE ampad.NOV_ANONYMOUS_VIEWS
SELECT ENTITY_ID, COUNT(*) AS NOV
FROM ampad.NOV 
WHERE USER_ID = 273950 
AND CLIENT = 'WEB'
AND (NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki2'
	 OR NORMALIZED_METHOD_SIGNATURE = 'GET /entity/#/wiki2/#')
GROUP BY ENTITY_ID;